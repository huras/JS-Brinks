<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>

    <script type="text/javascript">
      class Unit {
        constructor(ctx, x, y, fill, size, accel) {
          this.ctx = ctx;
          this.x = x;
          this.y = y;
          this.fill = fill;
          this.size = size;
          this.accel = accel;

          this.speed = { x: 0, y: 0 };
          this.bouncyness = 0.0;
        }

        draw() {
          var circle = new Path2D();
          circle.arc(this.x, this.y, this.size, 0, 2 * Math.PI);
          this.ctx.fillStyle = this.fill;
          this.ctx.fill(circle);
        }

        findClosestUnit(units) {
          let closerD = 1000000,
            closestUnit = null;
          for (let i = 0; i < units.length; i++) {
            let item = units[i];
            if (item != this) {
              let d = this.twoPointDistance(this.x, this.y, item.x, item.y);
              if (d < closerD) {
                d = closerD;
                closestUnit = item;
              }
            }
          }

          return { closestUnit: closestUnit, distance: closerD };
        }

        twoPointDistance(x1, y1, x2, y2) {
          return Math.sqrt(Math.pow(x1 - x2, 2), Math.pow(y1 - y2, 2));
        }

        walk(xSteps, ySteps) {
          this.speed = {
            x: this.speed.x + xSteps * this.accel,
            y: this.speed.y + ySteps * this.accel
          };
        }

        inertia(steps) {
          this.x += steps * this.speed.x;
          this.y += steps * this.speed.y;
        }

        checkUnitCollision(units) {
          let closestUnitData = this.findClosestUnit(units);
          if (closestUnitData) {
            if (
              closestUnitData.distance <=
              this.size / 2 + closestUnitData.closestUnit.size / 2
            ) {
              this.speed.x *= -this.bouncyness;
              this.x -= this.size;
              closestUnit.speed.x *= -this.bouncyness;
              closestUnit.x += closestUnit.size;

              this.speed.y *= -this.bouncyness;
              this.y -= this.size;
              closestUnit.speed.y *= -this.bouncyness;
              closestUnit.y += closestUnit.size;
            }
          }
        }

        checkScreenColision(w, h) {
          let jitter = 3;
          if (this.x > w) {
            this.speed.x *= -this.bouncyness;
            this.x = w - Math.random() * jitter;
          }
          if (this.x < 0) {
            this.speed.x *= -this.bouncyness;
            this.x = 0 + Math.random() * jitter;
          }

          if (this.y > h) {
            this.speed.y *= -this.bouncyness;
            this.y = h - Math.random() * jitter;
          }
          if (this.y < 0) {
            this.speed.y *= -this.bouncyness;
            this.y = 0 + Math.random() * jitter;
          }
        }
      }

      function loop() {
        window.ctx.fillStyle = "#fff";
        window.ctx.fillRect(0, 0, 800, 600);

        let lala = 0;
        units.map(item => {
          lala++;
          let closestUnitData = item.findClosestUnit(window.units);
          if (closestUnitData && lala != 933) {
            let xSteps = 0,
              ySteps = 0;

            if (closestUnitData.closestUnit.x < item.x) {
              xSteps--;
            } else if (closestUnitData.closestUnit.x > item.x) {
              xSteps++;
            }

            if (closestUnitData.closestUnit.y < item.y) {
              ySteps--;
            } else if (closestUnitData.closestUnit.y > item.y) {
              ySteps++;
            }

            item.walk(xSteps, ySteps);
          }
          item.inertia(1);
          item.checkScreenColision(800, 600);
          item.checkUnitCollision(window.units);
          item.draw();
        });
      }

      window.units = [];

      function start() {
        var canvas = document.getElementById("tutorial");
        if (canvas.getContext) {
          var ctx = canvas.getContext("2d");
          window.ctx = ctx;

          for (let i = 0; i < 10; i++) {
            const u = new Unit(
              ctx,
              Math.random() * 800,
              Math.random() * 600,
              "rgb(" +
                Math.random() * 255 +
                "," +
                Math.random() * 255 +
                "," +
                Math.random() * 255 +
                ")",
              10 + Math.random() * 18,
              0.1 + Math.random() / 2
            );
            window.units.push(u);
          }

          var myTimer = setInterval(loop, 20);
        }
      }
    </script>
    <style type="text/css">
      canvas {
        border: 1px solid black;
      }
    </style>
  </head>
  <body onload="start();">
    <canvas id="tutorial" width="800" height="600"></canvas>
  </body>
</html>

<!-- 
  O elemento <img>
    src
  O elemento <span>
  O elemento <div>
    display
    flex-direction
    justify-content
    align-items
    flex
  O elemento <a>
    href
  O elemento <input>
  O elemento <form>
    action
    method
  O elemento <canvas>
 -->
